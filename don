const checkAddressInput = async input => {
    console.time('address')
    let result = {ok: false};

    let response = await fetch(`https://civicinfo.googleapis.com/civicinfo/v2/representatives?address=${input}&levels=country&roles=legislatorLowerBody&roles=legislatorUpperBody&key=${process.env.REACT_APP_GOOGLE_CIVIC}`)

    if (response.ok) {
        let json = await response.json();
        const {line1, city, state, zip} = json.normalizedInput;
        result.normalizedAddress = `${line1}  ${city}, ${state} ${zip}`

        const divisionKeys = Object.keys(json.divisions)

        // Google formats XXXXXXX's Congressional District or <State> for us
        // Object keys not predictable but the longest key is the most specific (state + district > state)

        const mostGranularKey = divisionKeys.reduce((res, ele)=>{if (ele.length > res.length) res = ele; return res;}, '')
        result.addressRegion = json.divisions[mostGranularKey].name.replace(' congressional', '');
        
        let divisions = divisionKeys.map(d=>d.slice(d.lastIndexOf('/') + 1));

        divisions.forEach(i=>{
            let [type, value] = i.split(':');
            result[type] = value.toUpperCase();
        })

        if (result.state && result.cd) {
            result.ok = true;
        } else if (['DE', 'VT', 'WY', 'MT', 'ND', 'AK', 'SD'].includes(result.state)) {
            result.cd = '0';
            result.ok = true;
            result.addressRegion += "'s At-Large District"
        }
    } else {
        console.error('Malformed Address. Please try again.');
    }
    console.timeEnd('address');
    return result;
}



DELETE FROM CANDIDATE_INFO WHERE OFFICE_TYPE = 'P'


https://civicinfo.googleapis.com/civicinfo/v2/representatives?address=[object%20Object]&levels=country&roles=legislatorLowerBody&roles=legislatorUpperBody&key=AIzaSyA2-4DjIN5yykmlBCwbzjD0YESmjzgeWm8